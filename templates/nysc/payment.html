{% extends 'base.html' %}

{% block title %} {% endblock title %}

{% block body %}

Hello {{ order }}
<br>
You are about to pay for Nysc registration with us at sirmtech academiy solution.
This are the list of services you have selected to pay form:
<br>
Capturing : {{ order.capturing }}
<br>
Medical certificate: {{ order.medical }}
<br>
Passport : {{ order.passport }}
<br>
The total amount you are to pay is {{ order.get_amount }}


<div class="form-submit">
    <button type="submit" onclick="payWithPaystack()"> Pay </button>
  </div>



<script src="https://js.paystack.co/v1/inline.js"></script>

<script src="https://js.paystack.co/v1/inline.js"></script>
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
function payWithPaystack() {
  var handler = PaystackPop.setup({
    key: 'pk_test_feba4156df35513a5957f20e0ad24bdb65d19284', // Replace with your public key
    email: '{{order.email}}',
    amount: {{ order.get_amount }} * 100, // the amount value is multiplied by 100 to convert to the lowest currency unit
    currency: 'NGN', // Use GHS for Ghana Cedis or USD for US Dollars
    ref: ''+Math.floor((Math.random() * 1000000000) + 1), // Replace with a reference you generated
    callback: function(response) {
      // Make an AJAX call to your server with the reference to verify the transaction
      data = response.reference
      $.ajax({
        url: "{{ order.get_verify_payment }}",
        method: 'GET',

      });
      window.location.href = "{{ order.get_verify_payment }}";
      //this happens after the payment is completed successfully
      var reference = response.reference;
      //alert('Payment complete! Reference: ' + reference);

    },
    onClose: function() {
      alert('Transaction was not completed, window closed.');
    },
  });
  handler.openIframe();
}
</script>
{% endblock body %}
